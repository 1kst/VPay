
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="../../../img/favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="../../../css/okadmin.css">
  <link rel="stylesheet" href="../../../lib/loading/okLoading.min.css"/>
  <script type="text/javascript" src="../../../lib/loading/okLoading.min.js"></script>
  <link rel="stylesheet" href="../../../css/oksub.css"/>

</head>
<body class="ok-body home">
<div class="ok-body home">
  <style>
    .layui-table-cell {
      height: auto;
    }

    .layui-table img {
      max-width: 200px;
    }
  </style>
  <form action="" class="layui-form layui-form-pane" lay-filter="form">
    <div class="layui-form-item">
      <label class="layui-form-label">应用名称</label>
      <div class="layui-input-block">
        <input autocomplete="off" class="layui-input" lay-verify="required" name="app_name" placeholder="请输入应用名称"
               required type="text">
      </div>
    </div>

    <div class="layui-form-item">
      <label class="layui-form-label">异步回调</label>
      <div class="layui-input-block">
        <input autocomplete="off" class="layui-input" lay-verify="required" name="notify_url"
               placeholder="请输入异步回调地址" required type="text">
      </div>
    </div>
    <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">通讯密钥 <span class="layui-badge layui-bg-blue" id="random" style="color: white">随机生成</span></label>
      <div class="layui-input-block">
        <textarea class="layui-textarea" id="connect_key" name="connect_key" placeholder="请输入通讯密钥"></textarea>
      </div>
    </div>
    <div class="layui-form-item">
      <div class="">
        <button class="layui-btn layui-bg-blue" lay-filter="save" lay-submit>创建应用</button>
        <button class="layui-btn layui-btn-primary" id="reset" type="reset">重置</button>
      </div>
    </div>
  </form>

</div>
<script src="../../../js/common.js"></script>
<script src="../../../lib/layui/layui.js"></script>
<script>
  layui.config({
    base: '../../../js/'
  });
  layui.use(["okUtils","okMock","okLayer","form"], function () {
    let okUtils = layui.okUtils;
    let okLayer = layui.okLayer;
    let okMock=layui.okMock;
    let form=layui.form;
    okUtils.ajax(okMock.admin.login.isLogin, "post", null, true).done(function (response) {
    }).fail(function (error) {
      window.location = "../../login.html";
    });


    function randomString(len) {
      len = len || 32;
      var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';    /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/
      var maxPos = $chars.length;
      var pwd = '';
      for (var i = 0; i < len; i++) {
        pwd += $chars.charAt(Math.floor(Math.random() * maxPos));
      }
      return pwd;
    }

    okLoading.close();
    okUtils.ajax(okMock.admin.data.app, "post",null, true).done(function (response) {
      form.val("form",response.data);
    }).fail(function (error) {
      okLayer.time=2000
      okLayer.redCrossMsg(error)
      console.log(error)
    });

    layui.$("#random").on("click",function (e) {
      const token = randomString(64);
      layui.$("textarea").val(token)
    });
    form.on('submit(save)', function(data){
      var sendData=data.field;
      okUtils.ajax(okMock.admin.app.edit, "post",sendData, true).done(function (response) {
        okLayer.time=1000
        okLayer.greenTickMsg("操作成功", function () {
          var index=parent.layer.getFrameIndex(window.name);
          parent.layui.layer.close(index);
        })
      }).fail(function (error) {
        okLayer.time=2000
        okLayer.redCrossMsg(error)
        console.log(error)
      });
      return false;
    });


  });
</script>

</body>
</html>
